<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>茶壺商品展示</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
    .product-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: flex-start;
    }
    .product-card {
        width: 240px;
        flex: 0 0 240px;
    }
    .product-card .card-img-top {
        width: 100%;
        height: 240px;
        object-fit: cover;
        display: block;
        border-radius: 6px 6px 0 0;
    }
    .product-card .card-body {
        padding: .75rem;
    }
    @media (max-width: 576px) {
        .product-card { width: 100%; flex: 0 0 100%; }
    }
    @media (min-width: 577px) and (max-width: 900px) {
        .product-card { width: 45%; flex: 0 0 45%; }
    }
    #langToggleBtn {
        position: fixed;
        top: 80px;
        right: 20px;
        z-index: 1200;
    }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="navbar"></nav>
    </header>

    <button id="langToggleBtn" class="btn btn-sm btn-outline-light">EN/中</button>

    <div id="banner"></div>
    <br/><br/><br/><br/><br/>
    <div class="container my-3">
        <div class="row g-0" style="color: #949449; font-size: 1rem; text-align: center;">
            <h3 class="title my-3" style="font-size: clamp(0.9rem, 3vw, 1.5rem);"
                data-zh="時光為它們添上溫潤的光澤，也覆蓋了久遠的塵影。
               三十餘年的老壺，各自蘊藏著獨有的氣息與故事。
               壺上落款，是匠人留下的歲月簽名。"
                data-en="Time has given them a warm, gentle sheen, while also veiling traces of the distant past.
               Each of these teapots, over thirty years old, holds its own unique character and story.
               The inscriptions on the teapots are the artisans’ signatures, marking the passage of time.">
                時光為它們添上溫潤的光澤，也覆蓋了久遠的塵影。<br/>
                三十餘年的老壺，各自蘊藏著獨有的氣息與故事。<br/>
                壺上落款，是匠人留下的歲月簽名。
            </h3>
            <p style="margin-top: 1rem; font-size: clamp(0.8rem, 2vw, 1.2rem);"
               data-zh="靜候茗香共賞的有緣人。"
               data-en="Awaiting kindred spirits to enjoy the tea aroma together.">
                靜候茗香共賞的有緣人。
            </p>
        </div>
        <br />
        <div class="product-grid" id="product-container">
            </div>
    </div>

    <script>
    const API_URL = "http://localhost:3000/products"; 
    const TEA_CATEGORY = "teapot"; 
    let currentLang = 'zh'; // 預設語言

    document.addEventListener('DOMContentLoaded', () => {

        // 載入 menu-have-color.html (這部分依賴你的 menu-have-color.html 檔案)
        fetch('menu-have-color.html')
            .then(res => res.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
                
                // 假設語言切換按鈕 ID 是 'langToggleBtn'
                const langToggleBtn = document.getElementById('langToggleBtn'); 
                if (langToggleBtn) {
                    langToggleBtn.addEventListener('click', () => {
                        currentLang = currentLang === 'zh' ? 'en' : 'zh';
                        applyLanguage(currentLang);
                        localStorage.setItem('siteLang', currentLang); // 儲存語言設定
                    });
                }
                // 確保初始載入後語言正確
                const savedLang = localStorage.getItem('siteLang') || 'zh';
                applyLanguage(savedLang);
            })
            .catch(error => console.error("載入導航欄失敗:", error));
        
        // 語言切換邏輯
        function applyLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-zh], [data-en]').forEach(el => {
                const text = el.getAttribute(`data-${lang}`);
                if (text) el.textContent = text;
            });
            const langBtn = document.getElementById('langToggleBtn');
            if (langBtn) {
                langBtn.textContent = lang === 'zh' ? 'EN/中' : '中/EN';
            }
        }

        // 核心：從 API 取得商品並篩選茶壺
        async function fetchAndRenderTeapots() {
            const productContainer = document.querySelector('.product-grid');
            productContainer.innerHTML = '<div class="col-12 text-center text-muted">載入中...</div>';

            try {
                const res = await fetch(API_URL);
                if (!res.ok) throw new Error("API 請求失敗");
                
                let allProducts = await res.json();

                // 篩選出 category 為 'teapot' 的商品
                const teapotProducts = allProducts.filter(p => p.category === TEA_CATEGORY);
                
                if (teapotProducts.length === 0) {
                    productContainer.innerHTML = '<div class="col-12 text-center text-muted">目前沒有任何茶壺商品。</div>';
                    return;
                }

                productContainer.innerHTML = ''; // 清空載入中提示

                teapotProducts.forEach((product) => {
                    const productId = `product-${product.id}`; 
                    
                    const imagesList = Array.isArray(product.images) ? product.images : (product.image ? [product.image] : []);
                    
                    const imagesHtml = imagesList.map((imgUrl, imgIndex) => `
                        <div class="carousel-item ${imgIndex===0?'active':''}">
                            <img src="${imgUrl}" class="d-block w-100" alt="${product.zhTitle}" style="height:240px; object-fit:cover; border-radius: 6px 6px 0 0;">
                        </div>
                    `).join('');

                    const productCard = document.createElement('div');
                    productCard.className = 'product-card card';
                    productCard.innerHTML = `
                        <div id="${productId}" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2000" style="cursor:pointer;">
                            <div class="carousel-inner">${imagesHtml}</div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#${productId}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">上一張</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#${productId}" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">下一張</span>
                            </button>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title" data-zh="${product.zhTitle}" data-en="${product.enTitle}">${product.zhTitle}</h5>
                            <p class="text-danger" data-zh="${product.zhPrice}" data-en="${product.enPrice}">${product.zhPrice}</p>
                        </div>
                    `;

                    productCard.querySelector('.carousel').addEventListener('click', () => {
                        // 導向商品詳細頁，使用資料庫中的 link 欄位
                        window.location.href = product.link || `./teaset_commodity/default.html?id=${product.id}`;
                    });

                    productContainer.appendChild(productCard);
                });

                // 載入商品後再次套用語言，確保新生成的文字也切換
                applyLanguage(currentLang);

            } catch (error) {
                console.error("載入茶壺商品失敗:", error);
                productContainer.innerHTML = `<div class="col-12 text-center text-danger">商品載入失敗：${error.message}</div>`;
            }
        }
        
        fetchAndRenderTeapots();
    });
    </script>
</body>
</html>