<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>茶壺商品展示</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
    .product-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: flex-start;
    }
    .product-card {
        width: 240px;
        flex: 0 0 240px;
    }
    .product-card .card-img-top {
        width: 100%;
        height: 240px;
        object-fit: cover;
        display: block;
        border-radius: 6px 6px 0 0;
    }
    .product-card .card-body {
        padding: .75rem;
    }
    @media (max-width: 576px) {
        .product-card { width: 100%; flex: 0 0 100%; }
    }
    @media (min-width: 577px) and (max-width: 900px) {
        .product-card { width: 45%; flex: 0 0 45%; }
    }
    #langToggleBtn {
        position: fixed;
        top: 80px;
        right: 20px;
        z-index: 1200;
    }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="navbar"></nav>
    </header>

    <div id="banner"></div>
    <br/><br/><br/><br/><br/>
    <div class="container my-3">
        <div class="row g-0" style="color: #949449; font-size: 1rem; text-align: center;">
            <h3 class="title my-3" style="font-size: clamp(0.9rem, 3vw, 1.5rem);"
                data-zh="時光為它們添上溫潤的光澤，也覆蓋了久遠的塵影。
               三十餘年的老壺，各自蘊藏著獨有的氣息與故事。
               壺上落款，是匠人留下的歲月簽名。"
                data-en="Time has given them a warm, gentle sheen, while also veiling traces of the distant past.
               Each of these teapots, over thirty years old, holds its own unique character and story.
               The inscriptions on the teapots are the artisans’ signatures, marking the passage of time.">
                時光為它們添上溫潤的光澤，也覆蓋了久遠的塵影。<br/>
                三十餘年的老壺，各自蘊藏著獨有的氣息與故事。<br/>
                壺上落款，是匠人留下的歲月簽名。
            </h3>
            <p style="margin-top: 1rem; font-size: clamp(0.8rem, 2vw, 1.2rem);"
               data-zh="靜候茗香共賞的有緣人。"
               data-en="Awaiting kindred spirits to enjoy the tea aroma together.">
                靜候茗香共賞的有緣人。
            </p>
        </div>
        <br />
        <div class="product-grid" id="product-container"></div>
    </div>

    <script>
    // 修正 Vercel 部署問題：使用相對路徑
    const API_URL = "/products.json"; 
    const TEA_CATEGORY = "teaset"; // **定義茶壺類別**
    let currentLang = 'zh'; // 假設語言切換需要

    document.addEventListener('DOMContentLoaded', () => {

        // 載入 menu-have-color.html 及語言切換邏輯 (簡化)
        fetch('menu-have-color.html')
            .then(res => res.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;

                const toggleBtn = document.getElementById('toggle-lang');
                if(toggleBtn){
                    const applyLanguage = (lang) => {
                        currentLang = lang;
                        document.querySelectorAll('[data-zh], [data-en]').forEach(el => {
                            const text = el.getAttribute(`data-${lang}`);
                            if (text) el.textContent = text;
                        });
                        toggleBtn.innerText = lang === "en" ? "繁體中文" : "English";
                    };
                    
                    // 根據 toggleBtn 上的文字來判斷當前語言
                    toggleBtn.addEventListener('click', function(e){
                        e.preventDefault();
                        const nextLang = toggleBtn.innerText === "English" ? "zh" : "en";
                        applyLanguage(nextLang);
                    });

                    // 初始語言套用
                    applyLanguage(localStorage.getItem('siteLang') || 'zh');
                }
            });
        
        // 核心：從 API 取得商品並篩選茶壺
        async function renderTeapotProducts() { 
            const productContainer = document.querySelector('.product-grid');
            productContainer.innerHTML = '<div class="col-12 text-center text-muted">載入中...</div>';

            try {
                // 使用修正後的 API_URL
                const res = await fetch(API_URL); 
                if (!res.ok) throw new Error("API 請求失敗");
                
                const allProducts = await res.json();

                // **核心篩選：只保留 category 為 'teapot' 的商品**
                const filteredProducts = allProducts.filter(p => p.category === TEA_CATEGORY);
                const productsToRender = filteredProducts;

                if (productsToRender.length === 0) {
                    productContainer.innerHTML = '<div class="col-12 text-center text-muted">目前沒有任何茶壺作品。</div>';
                    return;
                }

                productContainer.innerHTML = ''; 

                productsToRender.forEach((product, index) => {
                    const productId = `product-${product.id || index}`; 
                    
                    const images = Array.isArray(product.images) ? product.images : (product.image ? [product.image] : []);
                    if (images.length === 0) images.push("/uploads/no-image.png");

                    const imagesHtml = images.map((imgUrl, imgIndex) => `
                        <div class="carousel-item ${imgIndex===0?'active':''}">
                            <img src="${imgUrl}" class="d-block w-100" alt="${product.zhTitle}" style="height:240px; object-fit:cover; border-radius: 6px 6px 0 0;">
                        </div>
                    `).join('');

                    const zhTitle = product.zhTitle || product.name || '';
                    const enTitle = product.enTitle || product.name || '';
                    const zhPrice = product.zhPrice || product.price || '聯絡我們獲得報價';
                    const enPrice = product.enPrice || product.price || 'Contact us for a quote';


                    const productCard = document.createElement('div');
                    productCard.className = 'product-card card';
                    productCard.innerHTML = `
                        <div id="${productId}" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2000" style="cursor:pointer;">
                            <div class="carousel-inner">${imagesHtml}</div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#${productId}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">上一張</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#${productId}" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">下一張</span>
                            </button>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title" data-zh="${zhTitle}" data-en="${enTitle}">
                                ${zhTitle}
                            </h5>
                            <p class="text-danger" data-zh="價格：${zhPrice}" data-en="Price: ${enPrice}">
                                價格：${zhPrice}
                            </p>
                        </div>
                    `;

                    productCard.querySelector('.carousel').addEventListener('click', () => {
                        window.location.href = product.link || `./teaset_commodity/first.html?id=${product.id || index}`;
                    });

                    productContainer.appendChild(productCard);
                });
                
                document.querySelectorAll('.carousel').forEach(carouselEl => {
                    new bootstrap.Carousel(carouselEl, {
                        interval: 2000,
                        ride: 'carousel'
                    });
                });

            } catch (err) {
                console.error('載入商品失敗:', err);
                productContainer.innerHTML = '<div class="col-12 text-center text-danger">載入商品資料失敗，請檢查後端服務。</div>';
            }
        }

        renderTeapotProducts();
    });
    </script>
</body>
</html>